import{_ as J,y as Z,M as A,N as H,q as C,O as K,P as Q,o as n,c,a as g,ab as X,ah as x,V as ee,U as ae,e as le,W as B,J as N,f as S,h as te,r as b,j as oe,k as se,b as i,w as V,l as P,F as re,Y as ie,u as j,a3 as ne,a2 as ue}from"./CBLPEO5m.js";import{u as de,a as me,_ as ce,b as pe}from"./D0wLo8BB.js";import{_ as ve}from"./7p6lLr2F.js";import{_ as be}from"./2FDutpCs.js";import{z as d}from"./DXqQCM1T.js";import{u as ge}from"./4_LvFyBa.js";import{u as fe}from"./08lz3Hdw.js";import"./5BPea2Hp.js";import"./A4Xj3Y_T.js";import"./BQaAxLrp.js";const ye=Z({inheritAttrs:!1,props:{value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>A.ui.radio.default.color,validator(e){return A.ui.colors.includes(e)}},ui:{type:Object,default:()=>A.ui.radio}},emits:["update:modelValue","change"],setup(e,{emit:p}){const L=H(),m=C(()=>K({},e.ui,L.ui.radio)),{emitFormBlur:y}=de(),k=C({get(){return e.modelValue},set(u){p("update:modelValue",u),u&&y()}}),t=C(()=>Q(m.value.base,m.value.background,m.value.border,m.value.ring.replaceAll("{color}",e.color),m.value.color.replaceAll("{color}",e.color)));return{ui:m,pick:k,inputClass:t}}}),he={class:"flex items-center h-5"},_e=["id","name","required","value","disabled"],Ve={key:0,class:"ms-3 text-sm"},Ce=["for"];function Se(e,p,L,m,y,k){return n(),c("div",{class:N(e.ui.wrapper)},[g("div",he,[X(g("input",ee({id:`${e.name}-${e.value}`,"onUpdate:modelValue":p[0]||(p[0]=t=>e.pick=t),name:e.name,required:e.required,value:e.value,disabled:e.disabled,type:"radio",class:["form-radio",e.inputClass]},e.$attrs,{onChange:p[1]||(p[1]=(...t)=>e.onChange&&e.onChange(...t))}),null,16,_e),[[x,e.pick]])]),e.label||e.$slots.label?(n(),c("div",Ve,[g("label",{for:`${e.name}-${e.value}`,class:N(e.ui.label)},[ae(e.$slots,"label",{},()=>[le(B(e.label),1)]),e.required?(n(),c("span",{key:0,class:N(e.ui.required)},"*",2)):S("",!0)],10,Ce),e.help?(n(),c("p",{key:0,class:N(e.ui.help)},B(e.help),3)):S("",!0)])):S("",!0)],2)}const Le=J(ye,[["render",Se]]),ke={class:"p-6"},$e={class:"flex gap-4"},Ue={class:"flex items-center gap-2"},Ne={key:0,class:"text-red-500 text-sm mt-1"},Be={class:"flex items-center gap-2"},Te={key:0,class:"text-red-500 text-sm mt-1"},ze={__name:"notifications",setup(e){const{toastSuccess:p,toastError:L}=me(),m=fe(),{categoryList:y}=ge(),k=te(),t=b("overall"),u=b(0),o=b([{category:"",amount:0}]),$=b("monthly"),s=b(!1),M=b({email:!0,push:!1,threshold:80}),h=b(""),_=b(""),O=[{value:"Daily",label:"Daily"},{value:"Weekly",label:"Weekly"},{value:"Monthly",label:"Monthly"},{value:"Yearly",label:"Yearly"}],D=()=>{var l,v;const a=(v=(l=k.value)==null?void 0:l.user_metadata)==null?void 0:v.spent_limiter;a&&(t.value=a.limiterType||"overall",$.value=a.limiterTimePeriod||"monthly",a.limiterType==="overall"?(u.value=Number(a.limiterValue)||0,o.value=[{category:"",amount:0}]):(u.value=0,o.value=Array.isArray(a.limiterCategories)?a.limiterCategories.map(f=>({category:f.category||"",amount:Number(f.amount)||0})):[{category:"",amount:0}]))};oe(t,a=>{a==="overall"?(o.value=[{category:"",amount:0}],_.value=""):(u.value=0,h.value="")});const F=C(()=>{const a={notifications:d.object({threshold:d.number().min(1).max(100)})};return t.value==="overall"?d.object({...a,overallLimit:d.number().positive("Overall spending limit must be a positive number")}):d.object({...a,categoryLimits:d.array(d.object({category:d.string().min(1,"Category is required"),amount:d.number().min(0,"Amount must be non-negative")})).min(1,"At least one category limit is required")})}),z=C(()=>!!(h.value||_.value)),W=()=>{o.value.length<y.length&&o.value.push({category:"",amount:0})},Y=a=>{o.value.length>1&&o.value.splice(a,1)},R=()=>{h.value="",_.value="";try{const a={notifications:{threshold:Number(M.value.threshold)},...t.value==="overall"?{overallLimit:Number(u.value)}:{categoryLimits:o.value.map(l=>({category:l.category,amount:Number(l.amount)}))}};return F.value.parse(a),!0}catch(a){return a instanceof d.ZodError&&a.errors.forEach(l=>{const[v]=l.path;v==="overallLimit"?h.value=l.message:v==="categoryLimits"&&(_.value="Please check category limits for errors")}),!1}},G=async()=>{if(R()){s.value=!0;try{const{error:a}=await m.auth.updateUser({data:{spent_limiter:{limiterValue:t.value==="overall"?Number(u.value):0,limiterType:t.value,limiterTimePeriod:$.value,limiterCategories:t.value==="category"?o.value.map(l=>({category:l.category,amount:Number(l.amount)})):[]}}});if(a)throw a;p({title:"Settings updated"})}catch(a){L({title:"Error updating settings",description:a.message})}finally{s.value=!1}}};return se(()=>{D()}),(a,l)=>{const v=Le,f=ce,E=pe,q=ve,T=ue,I=be;return n(),c("div",ke,[i(I,null,{header:V(()=>l[4]||(l[4]=[g("h1",{class:"text-3xl font-bold"},"Spent Limiter",-1)])),default:V(()=>[g("form",{onSubmit:ne(G,["prevent"])},[i(f,{label:"Limit Type",class:"mb-4"},{default:V(()=>[g("div",$e,[i(v,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=r=>t.value=r),value:"overall",label:"Overall Spending Limit",disabled:s.value},null,8,["modelValue","disabled"]),i(v,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=r=>t.value=r),value:"category",label:"Category Spending Limits",disabled:s.value},null,8,["modelValue","disabled"])])]),_:1}),t.value==="overall"?(n(),P(f,{key:0,label:"Overall Spending Limit",class:"mb-4"},{default:V(()=>[g("div",Ue,[i(E,{type:"number",modelValue:u.value,"onUpdate:modelValue":l[2]||(l[2]=r=>u.value=r),placeholder:"Enter overall spending limit",disabled:s.value,step:"0.01",min:"0"},null,8,["modelValue","disabled"])]),h.value?(n(),c("p",Ne,B(h.value),1)):S("",!0)]),_:1})):(n(),P(f,{key:1,label:"Category Spending Limits",class:"mb-4"},{default:V(()=>[(n(!0),c(re,null,ie(o.value,(r,w)=>(n(),c("div",{key:w,class:"mb-2"},[g("div",Be,[i(q,{modelValue:r.category,"onUpdate:modelValue":U=>r.category=U,options:j(y),class:"flex-1",disabled:s.value},null,8,["modelValue","onUpdate:modelValue","options","disabled"]),i(E,{type:"number",modelValue:r.amount,"onUpdate:modelValue":U=>r.amount=U,placeholder:"Limit amount",class:"w-32",disabled:s.value,step:"0.01",min:"0"},null,8,["modelValue","onUpdate:modelValue","disabled"]),i(T,{color:"red",variant:"soft",icon:"i-heroicons-trash",onClick:U=>Y(w),disabled:s.value||o.value.length<=1},null,8,["onClick","disabled"])])]))),128)),i(T,{size:"sm",color:"gray",variant:"soft",icon:"i-heroicons-plus",label:"Add Category Limit",onClick:W,disabled:s.value||o.value.length>=j(y).length,class:"mt-2"},null,8,["disabled"]),_.value?(n(),c("p",Te,B(_.value),1)):S("",!0)]),_:1})),i(f,{label:"Limit Time Period",class:"mb-4"},{default:V(()=>[i(q,{modelValue:$.value,"onUpdate:modelValue":l[3]||(l[3]=r=>$.value=r),options:O,disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),i(T,{class:"mt-4",type:"submit",color:"black",variant:"solid",label:"Save Settings",loading:s.value,disabled:s.value||z.value},null,8,["loading","disabled"])],32)]),_:1})])}}};export{ze as default};
