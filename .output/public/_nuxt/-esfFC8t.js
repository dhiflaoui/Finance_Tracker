import{h as g,r as f,c as y,a as m,b as e,w as v,u as i,a3 as x,o as U,L as $}from"./CVTLfr-j.js";import{_ as k,a as A}from"./DTyaJT8V.js";import{u as C}from"./CkJbm7BT.js";import{u as N}from"./CIyTCRbJ.js";import{u as S}from"./BOMmvIL2.js";const B={class:"mb-4"},E={class:"mb-4"},L={__name:"avatar",setup(I){const u=C(),s=g(),{toastSuccess:h,toastError:p}=N(),o=f(!1),c=f(null),{avatarUrl:b}=S(),w=async()=>{var t;const r=c.value.input.files[0];if(!r){p({title:"No file selected",description:"Please select a file to upload First"});return}const _=r.name.split(".").pop(),l=`${Math.random()}.${_}`;try{o.value=!0;const a=(t=s.value.user_metadata)==null?void 0:t.avatar_url,{error:n}=await u.storage.from("avatars").upload(`${s.value.id}/${l}`,r,{cacheControl:"3600",upsert:!0});if(n)throw n;if(h({title:"Avatar uploaded successfully",description:"Your avatar has been uploaded successfully"}),await u.auth.updateUser({data:{avatar_url:`${s.value.id}/${l}`}}),a){const{error:d}=await u.storage.from("avatars").remove([`${s.value.id}/${a.split("/").pop()}`]);if(d)throw d}c.value.input.value=null}catch(a){p({title:"Error uploading avatar",description:a.message})}finally{o.value=!1}};return(r,_)=>{const l=$,t=k,a=A,n=x;return U(),y("div",null,[m("div",B,[e(t,{label:"Current avatar",class:"w-full",help:"This would be blank by default"},{default:v(()=>[e(l,{src:i(b)??"https://avatars.githubusercontent.com/u/739984?v=4",size:"3xl"},null,8,["src"])]),_:1})]),m("div",E,[e(t,{label:"New avatar",class:"w-full",name:"avatar",help:"After choosing an image click Save to actually upload the new avatar"},{default:v(()=>[e(a,{type:"file",ref_key:"fileInput",ref:c},null,512)]),_:1})]),e(n,{type:"submit",color:"black",variant:"solid",label:"Save",loading:i(o),disabled:i(o),onClick:w},null,8,["loading","disabled"])])}}};export{L as default};
