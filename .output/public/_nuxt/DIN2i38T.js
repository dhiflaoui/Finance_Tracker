import{h as g,r as f,c as y,a as v,b as e,w as m,u as i,$ as x,o as $,J as U}from"./B9gK5A-A.js";import{a as k,_ as A,b as C}from"./DxZlTcge.js";import{u as N}from"./COzxk5WM.js";import{u as S}from"./DjB-BuO2.js";const B={class:"mb-4"},E={class:"mb-4"},G={__name:"avatar",setup(I){const u=N(),s=g(),{toastSuccess:b,toastError:p}=k(),o=f(!1),c=f(null),{avatarUrl:h}=S(),w=async()=>{var t;const l=c.value.input.files[0];if(!l){p({title:"No file selected",description:"Please select a file to upload First"});return}const _=l.name.split(".").pop(),r=`${Math.random()}.${_}`;try{o.value=!0;const a=(t=s.value.user_metadata)==null?void 0:t.avatar_url,{error:n}=await u.storage.from("avatars").upload(`${s.value.id}/${r}`,l,{cacheControl:"3600",upsert:!0});if(n)throw n;if(b({title:"Avatar uploaded successfully",description:"Your avatar has been uploaded successfully"}),await u.auth.updateUser({data:{avatar_url:`${s.value.id}/${r}`}}),a){const{error:d}=await u.storage.from("avatars").remove([`${s.value.id}/${a.split("/").pop()}`]);if(d)throw d}c.value.input.value=null}catch(a){p({title:"Error uploading avatar",description:a.message})}finally{o.value=!1}};return(l,_)=>{const r=U,t=A,a=C,n=x;return $(),y("div",null,[v("div",B,[e(t,{label:"Current avatar",class:"w-full",help:"This would be blank by default"},{default:m(()=>[e(r,{src:i(h)??"https://avatars.githubusercontent.com/u/739984?v=4",size:"3xl"},null,8,["src"])]),_:1})]),v("div",E,[e(t,{label:"New avatar",class:"w-full",name:"avatar",help:"After choosing an image click Save to actually upload the new avatar"},{default:m(()=>[e(a,{type:"file",ref_key:"fileInput",ref:c},null,512)]),_:1})]),e(n,{type:"submit",color:"black",variant:"solid",label:"Save",loading:i(o),disabled:i(o),onClick:w},null,8,["loading","disabled"])])}}};export{G as default};
