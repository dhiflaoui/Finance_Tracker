import{y as m,r as d,A as u,B as v,ah as y}from"./dmGC-s-I.js";const A=m({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]}},setup(t,{slots:n,expose:a}){const r=Math.random().toString(36).substring(7),s=y(`form-${r}`);s.on(async e=>{if(e.type==="blur"){const h=i.value.filter(o=>o.path!==e.path),l=(await c()).filter(o=>o.path===e.path);i.value=h.concat(l)}});const i=d([]);u("form-errors",i),u("form-events",s);async function c(){let e=await t.validate(t.state);if(t.schema)if(p(t.schema))e=e.concat(await b(t.state,t.schema));else if(w(t.schema))e=e.concat(await E(t.state,t.schema));else if(S(t.schema))e=e.concat(await j(t.state,t.schema));else throw new Error("Form validation failed: Unsupported form schema");return e}async function f(){if(i.value=await c(),i.value.length>0)throw new Error(`Form validation failed: ${JSON.stringify(i.value,null,2)}`);return t.state}return a({validate:f}),()=>{var e;return v("form",(e=n.default)==null?void 0:e.call(n))}}});function w(t){return t.validate&&t.__isYupSchema__}function g(t){return t.inner!==void 0}async function E(t,n){try{return await n.validate(t,{abortEarly:!1}),[]}catch(a){if(g(a))return a.inner.map(r=>({path:r.path??"",message:r.message}));throw a}}function p(t){return t.parse!==void 0}function _(t){return t.issues!==void 0}async function b(t,n){try{return n.parse(t),[]}catch(a){if(_(a))return a.issues.map(r=>({path:r.path.join("."),message:r.message}));throw a}}function S(t){return t.validateAsync!==void 0&&t.id!==void 0}function J(t){return t.isJoi===!0}async function j(t,n){try{return await n.validateAsync(t,{abortEarly:!1}),[]}catch(a){if(J(a))return a.details.map(r=>({path:r.path.join("."),message:r.message}));throw a}}export{A as _};
